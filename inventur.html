<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventur Druck</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/docx@8.1.0/build/index.js"></script>
<style>
  body { background:#f8f9fa; }
  .block {
    background:white;
    padding:15px;
    margin-bottom:15px;
    border-radius:8px;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
  }
</style>
</head>
<body class="p-4">

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Inventur Druck Generator</h2>
    <a href="index.html" class="btn btn-secondary">üè† Heim</a>
  </div>

  <div id="blocksContainer"></div>

  <button class="btn btn-outline-primary mb-3" onclick="addBlock()">‚ûï Block hinzuf√ºgen</button>

  <div class="d-flex flex-wrap gap-2">
    <button class="btn btn-primary" onclick="generatePDF()">üìÑ PDF erzeugen</button>
    <!--<button class="btn btn-success" onclick="generateWord()">üìù Word erzeugen</button>-->
  </div>

  <div id="downloadLinkContainer" class="mt-3"></div>
</div>

<script>
// üß± Erstellt einen neuen Eingabe-Block new Date().getFullYear()
function addBlock(feld='', von=1, bis=15, jahr=2026){
  const container = document.getElementById('blocksContainer');
  const block = document.createElement('div');
  block.className = 'block';

  block.innerHTML = `
    <div class="row g-2 align-items-end">
      <div class="col-md-3">
        <label class="form-label">Feld-Nr</label>
        <input type="number" class="form-control feldNummer" value="${feld}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Regal von</label>
        <input type="number" class="form-control regalVon" value="${von}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Regal bis</label>
        <input type="number" class="form-control regalBis" value="${bis}">
      </div>
      <div class="col-md-2">
        <label class="form-label">Jahr</label>
        <input type="number" class="form-control jahr" value="${jahr}">
      </div>
      <div class="col-md-1 text-end">
        <button class="btn btn-outline-danger" onclick="this.closest('.block').remove()">‚ùå</button>
      </div>
    </div>
  `;
  container.appendChild(block);
}

// Beim Start ein Block anzeigen
addBlock();

// üü¶ PDF Generator ‚Äì pro Druck eine Seite
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });
  const pageWidth = doc.internal.pageSize.width;
  const pageHeight = doc.internal.pageSize.height;

  doc.setFont("Helvetica", "normal");
  doc.setFontSize(130);

  const blocks = document.querySelectorAll('.block');
  let first = true;

  blocks.forEach(block=>{
    const feld = block.querySelector('.feldNummer').value || '-';
    const von = parseInt(block.querySelector('.regalVon').value) || 1;
    const bis = parseInt(block.querySelector('.regalBis').value) || 15;
    const jahr = block.querySelector('.jahr').value || new Date().getFullYear();

    for(let r=von; r<=bis; r++){
      if(!first) doc.addPage();
      first=false;
      const oben = `${feld}/${r}`;
      const mitte = `${jahr}`;
      const obenW = doc.getTextWidth(oben);
      const mitteW = doc.getTextWidth(mitte);
      doc.text(oben, (pageWidth-obenW)/2, pageHeight/2 - 100);
      doc.text(mitte, (pageWidth-mitteW)/2, pageHeight/2 + 50);
    }
  });

  doc.save('Inventur.pdf');
}

// üü© Word Generator ‚Äì zentriert pro Seite
async function generateWord(){
  const { Document, Packer, Paragraph, TextRun, AlignmentType } = window.docx;
  const blocks = document.querySelectorAll('.block');
  const sections = [];

  blocks.forEach(block=>{
    const feld = block.querySelector('.feldNummer').value || '-';
    const von = parseInt(block.querySelector('.regalVon').value) || 1;
    const bis = parseInt(block.querySelector('.regalBis').value) || 15;
    const jahr = block.querySelector('.jahr').value || new Date().getFullYear();

    for(let r=von; r<=bis; r++){
      sections.push({
        properties: {},
        children: [
          new Paragraph({
            alignment: AlignmentType.CENTER,
            spacing: { after: 800 },
            children: [ new TextRun({ text: `${feld}/${r}`, font: "Calibri", size: 260 }) ]
          }),
          new Paragraph({
            alignment: AlignmentType.CENTER,
            children: [ new TextRun({ text: `${jahr}`, font: "Calibri", size: 260 }) ]
          })
        ]
      });
    }
  });

  const doc = new Document({ sections });
  const blob = await Packer.toBlob(doc);

  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = "Inventur.docx";
  link.textContent = "üì• Inventur.docx herunterladen";
  link.className = "btn btn-outline-primary mt-3";

  const container = document.getElementById("downloadLinkContainer");
  container.innerHTML = "";
  container.appendChild(link);
}
</script>

</body>
</html>

